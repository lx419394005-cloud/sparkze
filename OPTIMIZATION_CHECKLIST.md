# Sparkze 优化实施清单

## 📋 第一阶段: 基础设施 (预计 1-2 小时)

### 1. 引入工具库
- [ ] 在 `sidepanel.html` 中添加 `<script src="utils.js"></script>`
- [ ] 在 `gallery.html` 中添加 `<script src="utils.js"></script>`
- [ ] 在 `draw.html` 中添加 `<script src="utils.js"></script>`
- [ ] 在 `options.html` 中添加 `<script src="utils.js"></script>`

### 2. 验证工具库
- [ ] 在 Chrome 中重新加载插件
- [ ] 打开控制台,输入 `SparkzeUtils` 验证是否加载成功
- [ ] 测试基本功能是否正常

## 📋 第二阶段: 日志系统迁移 (预计 2-3 小时)

### 自动化方式
- [ ] 运行 `./optimize.sh` 脚本
- [ ] 检查备份文件是否创建在 `.backup/` 目录
- [ ] 查看替换统计结果

### 手动方式 (如果不使用脚本)
- [ ] 替换 `background.js` 中的 console.log
- [ ] 替换 `content.js` 中的 console.log
- [ ] 替换 `sidepanel.js` 中的 console.log
- [ ] 替换 `gallery.js` 中的 console.log
- [ ] 替换 `draw.js` 中的 console.log
- [ ] 替换 `options.js` 中的 console.log

### 验证
- [ ] 重新加载插件
- [ ] 测试所有功能
- [ ] 检查控制台日志是否正常显示
- [ ] 验证 `SparkzeUtils.logger.enabled = false` 可以关闭日志

## 📋 第三阶段: 存储操作优化 (预计 1-2 小时)

### background.js
- [ ] 替换 `chrome.storage.local.get` 为 `SparkzeUtils.storage.get`
- [ ] 替换 `chrome.storage.local.set` 为 `SparkzeUtils.storage.set`
- [ ] 添加错误处理

### sidepanel.js
- [ ] 替换存储操作
- [ ] 添加错误处理

### gallery.js
- [ ] 替换存储操作
- [ ] 添加错误处理

### options.js
- [ ] 替换存储操作
- [ ] 添加错误处理

### 验证
- [ ] 测试保存功能
- [ ] 测试读取功能
- [ ] 测试删除功能
- [ ] 检查错误处理是否生效

## 📋 第四阶段: 性能优化 (预计 2-3 小时)

### 添加防抖/节流
- [ ] 搜索输入添加防抖 (sidepanel.js)
- [ ] 搜索输入添加防抖 (gallery.js)
- [ ] 滚动事件添加节流 (gallery.js)
- [ ] 窗口 resize 事件添加节流

### DOM 查询优化
- [ ] 识别频繁查询的元素
- [ ] 使用 `SparkzeUtils.dom.$` 替换
- [ ] 在页面卸载时清理缓存

### Toast 通知统一
- [ ] 替换自定义 toast 为 `SparkzeUtils.toast`
- [ ] 删除重复的 toast 代码

### 验证
- [ ] 运行性能测试: `SparkzePerformanceTest.runAll()`
- [ ] 对比优化前后的性能数据
- [ ] 检查内存使用情况

## 📋 第五阶段: 测试与验证 (预计 1-2 小时)

### 功能测试
- [ ] 图片悬停显示 badge
- [ ] 点击分析按钮
- [ ] AI 分析功能
- [ ] 保存到收藏夹
- [ ] 快速收藏功能
- [ ] 搜索和筛选
- [ ] 标签管理
- [ ] Wiki 视图
- [ ] 批量操作
- [ ] 绘图功能
- [ ] 设置页面

### 性能测试
- [ ] 运行 `SparkzePerformanceTest.runAll()`
- [ ] 检查日志性能
- [ ] 检查存储性能
- [ ] 检查 DOM 查询性能
- [ ] 检查内存使用

### 兼容性测试
- [ ] 在不同网站测试 (Pinterest, Behance, Instagram)
- [ ] 测试不同尺寸的图片
- [ ] 测试大量数据的情况

## 📋 第六阶段: 生产环境配置 (预计 10 分钟)

### 配置
- [ ] 在 `utils.js` 中设置 `logger.enabled = false`
- [ ] 清理测试数据
- [ ] 删除 `.backup/` 目录 (如果确认无问题)

### 最终验证
- [ ] 重新加载插件
- [ ] 确认日志已关闭
- [ ] 测试核心功能
- [ ] 检查性能提升

## 📋 可选优化 (长期)

### 代码分割
- [ ] 拆分 `gallery.js` 为多个模块
- [ ] 拆分 `styles.css` 为多个文件
- [ ] 实现按需加载

### 图片优化
- [ ] 实现图片懒加载
- [ ] 实现虚拟滚动
- [ ] 添加图片预加载

### 错误监控
- [ ] 添加全局错误捕获
- [ ] 实现错误上报
- [ ] 添加性能监控

### Service Worker 优化
- [ ] 优化后台脚本
- [ ] 实现状态持久化
- [ ] 使用 chrome.alarms

## 📊 优化效果记录

### 优化前
- 运行时性能: ___________
- 内存使用: ___________
- 页面响应时间: ___________
- Console 日志数量: 65+

### 优化后
- 运行时性能: ___________
- 内存使用: ___________
- 页面响应时间: ___________
- Console 日志数量: ___________

### 性能提升
- 运行时性能提升: ___________%
- 内存节省: ___________MB
- 响应速度提升: ___________%

## 🐛 问题记录

### 遇到的问题
1. ___________________________________________
2. ___________________________________________
3. ___________________________________________

### 解决方案
1. ___________________________________________
2. ___________________________________________
3. ___________________________________________

## 📝 备注

- 优化开始时间: ___________
- 优化完成时间: ___________
- 总耗时: ___________
- 优化人员: ___________

## ✅ 完成标志

- [ ] 所有核心功能正常
- [ ] 性能有明显提升
- [ ] 无控制台错误
- [ ] 文档已更新
- [ ] 代码已提交

---

**提示**: 
- 每完成一项就打勾 ✓
- 遇到问题记录在"问题记录"部分
- 优化前后记得对比性能数据
- 保持备份,以便回滚
